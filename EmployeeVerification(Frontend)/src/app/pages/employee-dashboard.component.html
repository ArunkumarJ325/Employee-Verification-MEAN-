<!-- Top Bar: Welcome + Logout (Always visible) -->
<!-- <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
  <div *ngIf="EmployeeName">
    <h1>Welcome, {{ EmployeeName }}!</h1>
  </div>
  <button (click)="logout()">Logout</button>
</div> -->

<!-- Profile Exists -->
<!-- <div *ngIf="profile !== null; else profilenotfound"> -->
  <!-- Profile Info -->
  <!-- <div style="border: 1px solid #ccc; padding: 20px; border-radius: 8px;">
    <p><strong>Address:</strong> {{ profile.address }}</p>
    <p><strong>Years of Experience:</strong> {{ profile.yearsOfExperience }}</p>
    <p><strong>Previous Companies:</strong></p>
    <ul>
      <li *ngFor="let company of profile.previousCompanies">{{ company }}</li>
    </ul>
    <p><strong>Status:</strong> {{ profile.status }}</p>
    <p><strong>Aadhar Number:</strong> {{ profile.aadharNumber }}</p>
    <p><strong>PAN Number:</strong> {{ profile.panNumber }}</p>
  </div> -->

  <!-- Documents -->
  <!-- <h3 style="margin-top: 30px;">Your Documents</h3>

  <ul *ngIf="documents.length > 0; else noDocs">
    <li *ngFor="let doc of documents" style="margin-bottom: 15px; border: 1px solid #ccc; padding: 10px; border-radius: 8px;">
      <div>
        <strong>Type:</strong> {{ doc.type }} <br />
        <strong>Document Number:</strong> {{ doc.documentNumber }} <br /> -->
  
        <!-- Manager Verification -->
        <!-- <ng-container *ngIf="doc.verifiedStatus === 'PENDING'; else managerInfo">
          <strong>Status:</strong> ðŸ•’ Waiting for Manager to verify this document. <br />
        </ng-container>
        <ng-template #managerInfo>
          <strong>Manager:</strong> {{ doc.verifiedBy?.name || 'N/A' }} <br />
          <strong>Manager Status:</strong>
          <span [ngClass]="{
            'text-green-600': doc.verifiedStatus === 'APPROVED',
            'text-red-600': doc.verifiedStatus === 'REJECTED'
          }">{{ doc.verifiedStatus }}</span> <br />
          <strong>Manager Comment:</strong> {{ doc.comment || 'No comment' }} <br />
        </ng-template> -->
  
        <!-- HR Verification - Only show if Manager approves -->
        <!-- <ng-container *ngIf="doc.verifiedStatus === 'APPROVED'">
          <ng-container *ngIf="doc.finalVerifiedStatus === 'PENDING'; else hrInfo">
            <strong>Status:</strong> ðŸ•’ Waiting for HR to verify this document. <br />
          </ng-container>
          <ng-template #hrInfo>
            <strong>HR:</strong> {{ doc.finalVerifiedBy?.name || 'N/A' }} <br />
            <strong>HR Status:</strong>
            <span [ngClass]="{
              'text-green-600': doc.finalVerifiedStatus === 'APPROVED',
              'text-red-600': doc.finalVerifiedStatus === 'REJECTED'
            }">{{ doc.finalVerifiedStatus }}</span> <br />
            <strong>HR Comment:</strong> {{ doc.finalComment || 'No comment' }} <br />
          </ng-template>
        </ng-container> -->
  
        <!-- Display HR status only if the manager approves -->
        <!-- <ng-container *ngIf="doc.verifiedStatus === 'REJECTED' || doc.finalVerifiedStatus === 'REJECTED'">
          <div style="margin-top: 10px;">
            <label>Reupload File:</label>
            <input type="file" (change)="onFileSelected($event, doc._id)" />
            <button (click)="reuploadFile(doc._id)" [disabled]="!selectedFiles[doc._id]">Submit</button>
          </div>
        </ng-container>
        
        
  
        <a [href]="'http://localhost:5000' + doc.fileUrl" target="_blank">
          <button>Preview / Download</button>
        </a>
      </div>
    </li>
  </ul>
  
  <ng-template #noDocs>
    <p>No documents uploaded yet.</p>
  </ng-template>
  
  
  <ng-template #noDocs>
    <p>No documents uploaded yet.</p>
  </ng-template>
  

  <ng-template #noDocs>
    <p>No documents uploaded yet.</p>
  </ng-template> -->

  <!-- Upload -->
  <!-- <button routerLink="/employee/upload" style="margin-top: 20px;">Upload New Document</button>
</div> -->

<!-- Profile Not Created: Create Profile Form -->
<!-- <ng-template #profilenotfound>
  <div style="text-align: center; padding: 30px;">
    <h2>ðŸ‘¤ Profile Not Found</h2>
    <p>You haven't created your profile yet. Please fill in the details below.</p> -->

    <!-- Profile Creation Form -->
    <!-- <form (ngSubmit)="createProfile()">
      <div>
        <label for="name">Name:</label>
        <input type="text" id="name" [(ngModel)]="profileData.name" name="name" required />
      </div>

      <div>
        <label for="address">Address:</label>
        <input type="text" id="address" [(ngModel)]="profileData.address" name="address" required />
      </div>

      <div>
        <label for="yearsOfExperience">Years of Experience:</label>
        <input type="number" id="yearsOfExperience" [(ngModel)]="profileData.yearsOfExperience" name="yearsOfExperience" required />
      </div>

      <div>
        <label for="previousCompanies">Previous Companies:</label>
        <input type="text" id="previousCompanies" [(ngModel)]="profileData.previousCompanies" name="previousCompanies" required />
      </div>

      <div>
        <label for="status">Status:</label>
        <input type="text" id="status" [(ngModel)]="profileData.status" name="status" required />
      </div>

      <div>
        <label for="aadharNumber">Aadhar Number:</label>
        <input type="text" id="aadharNumber" [(ngModel)]="profileData.aadharNumber" name="aadharNumber" required />
      </div>

      <div>
        <label for="panNumber">PAN Number:</label>
        <input type="text" id="panNumber" [(ngModel)]="profileData.panNumber" name="panNumber" required />
      </div>

      <button type="submit" style="margin-top: 20px;">Create Profile</button>
    </form>
  </div>
</ng-template> -->


<!-- Top Bar -->
<div class="top-bar">
  <div *ngIf="EmployeeName">
    <h1>Welcome, {{ EmployeeName }}!</h1>
  </div>
  <button (click)="logout()">Logout</button>
</div>

<!-- Profile Exists -->
<div *ngIf="profile !== null; else profilenotfound" class="dashboard-container">
  <div class="card">
    <h2>Profile Information</h2>
    <p><strong>Address:</strong> {{ profile.address }}</p>
    <p><strong>Years of Experience:</strong> {{ profile.yearsOfExperience }}</p>
    <p><strong>Previous Companies:</strong></p>
    <ul>
      <li *ngFor="let company of profile.previousCompanies">{{ company }}</li>
    </ul>
    <p><strong>Status:</strong> {{ profile.status }}</p>
    <p><strong>Aadhar Number:</strong> {{ profile.aadharNumber }}</p>
    <p><strong>PAN Number:</strong> {{ profile.panNumber }}</p>
  </div>

  <div class="card">
    <h3>Your Documents</h3>

    <ul *ngIf="documents.length > 0; else noDocs">
      <li *ngFor="let doc of documents" class="doc-item">
        <div>
          <strong>Type:</strong> {{ doc.type }} <br />
          <strong>Document Number:</strong> {{ doc.documentNumber }} <br />

          <!-- Manager Verification -->
          <ng-container *ngIf="doc.verifiedStatus === 'PENDING'; else managerInfo">
            <strong>Status:</strong> ðŸ•’ Waiting for Manager to verify this document. <br />
          </ng-container>
          <ng-template #managerInfo>
            <strong>Manager:</strong> {{ doc.verifiedBy?.name || 'N/A' }} <br />
            <strong>Manager Status:</strong>
            <span [ngClass]="{
              'text-green-600': doc.verifiedStatus === 'APPROVED',
              'text-red-600': doc.verifiedStatus === 'REJECTED'
            }">{{ doc.verifiedStatus }}</span><br />
            <strong>Manager Comment:</strong> {{ doc.comment || 'No comment' }} <br />
          </ng-template>

          <!-- HR Verification - Only show if Manager approves -->
          <ng-container *ngIf="doc.verifiedStatus === 'APPROVED'">
            <ng-container *ngIf="doc.finalVerifiedStatus === 'PENDING'; else hrInfo">
              <strong>Status:</strong> ðŸ•’ Waiting for HR to verify this document. <br />
            </ng-container>
            <ng-template #hrInfo>
              <strong>HR:</strong> {{ doc.finalVerifiedBy?.name || 'N/A' }} <br />
              <strong>HR Status:</strong>
              <span [ngClass]="{
                'text-green-600': doc.finalVerifiedStatus === 'APPROVED',
                'text-red-600': doc.finalVerifiedStatus === 'REJECTED'
              }">{{ doc.finalVerifiedStatus }}</span> <br />
              <strong>HR Comment:</strong> {{ doc.finalComment || 'No comment' }} <br />
            </ng-template>
          </ng-container>

          <!-- Reupload if rejected -->
          <ng-container *ngIf="doc.verifiedStatus === 'REJECTED' || doc.finalVerifiedStatus === 'REJECTED'">
            <div class="reupload-container">
              <label>Reupload File:</label>
              <input type="file" (change)="onFileSelected($event, doc._id)" />
              <button (click)="reuploadFile(doc._id)" [disabled]="!selectedFiles[doc._id]">Submit</button>
            </div>
          </ng-container>

          <a [href]="'http://localhost:5000' + doc.fileUrl" target="_blank">
            <button class="button">Preview / Download</button>
          </a>
        </div>
      </li>
    </ul>

    <ng-template #noDocs>
      <p>No documents uploaded yet.</p>
    </ng-template>

    <button routerLink="/employee/upload" class="button">Upload New Document</button>
  </div>
</div>

<!-- Profile Creation Form -->
<ng-template #profilenotfound>
  <div class="form-container">
    <h2>ðŸ‘¤ Profile Not Found</h2>
    <p>Please fill in your profile information below:</p>

    <form (ngSubmit)="createProfile()" #profileForm="ngForm" class="form-grid">
      
      <!-- Name Field -->
      <label>Name:
        <input type="text" [(ngModel)]="profileData.name" name="name" required #name="ngModel" />
      </label>
      <div *ngIf="name.invalid && name.touched" class="error-message">
        <small>Name is required</small>
      </div>

      <!-- Address Field -->
      <label>Address:
        <input type="text" [(ngModel)]="profileData.address" name="address" required #address="ngModel" />
      </label>
      <div *ngIf="address.invalid && address.touched" class="error-message">
        <small>Address is required</small>
      </div>

      <!-- Years of Experience Field -->
      <label>Years of Experience:
        <input type="number" [(ngModel)]="profileData.yearsOfExperience" name="yearsOfExperience" required #yearsOfExperience="ngModel" />
      </label>
      <div *ngIf="yearsOfExperience.invalid && yearsOfExperience.touched" class="error-message">
        <small>Years of Experience are required</small>
      </div>

      <!-- Previous Companies Field -->
      <label>Previous Companies:
        <input type="text" [(ngModel)]="profileData.previousCompanies" name="previousCompanies" required #previousCompanies="ngModel" />
      </label>
      <div *ngIf="previousCompanies.invalid && previousCompanies.touched" class="error-message">
        <small>Previous Companies are required</small>
      </div>

      <!-- Status Field -->
      <label>Status:
        <input type="text" [(ngModel)]="profileData.status" name="status" required #status="ngModel" />
      </label>
      <div *ngIf="status.invalid && status.touched" class="error-message">
        <small>Status is required</small>
      </div>

      <!-- Aadhar Number Field -->
      <label>Aadhar Number:
        <input type="text"
               [(ngModel)]="profileData.aadharNumber"
               name="aadharNumber"
               required
               pattern="^[0-9]{12}$"
               maxlength="12"
               title="Aadhar number must be exactly 12 digits"
               #aadharNumber="ngModel" />
      </label>
      <div *ngIf="aadharNumber.invalid && aadharNumber.touched" class="error-message">
        <small *ngIf="aadharNumber.errors?.['required']">Aadhar Number is required</small>
        <small *ngIf="aadharNumber.errors?.['pattern']">Aadhar Number must be exactly 12 digits and N0 characters allowed</small>
      </div>

      <!-- PAN Number Field -->
      <label>PAN Number:
        <input type="text"
               [(ngModel)]="profileData.panNumber"
               name="panNumber"
               required
               pattern="^[A-Z0-9]{10}$"
               maxlength="10"
               title="PAN number must be 10 alphanumeric characters (uppercase letters and numbers only)"
               #panNumber="ngModel" />
      </label>
      <div *ngIf="panNumber.invalid && panNumber.touched" class="error-message">
        <small *ngIf="panNumber.errors?.['required']">PAN Number is required</small>
        <small *ngIf="panNumber.errors?.['pattern']">PAN Number must be 10 alphanumeric characters (uppercase letters and numbers only)</small>
      </div>

      <!-- Submit Button -->
      <button type="submit" class="button full-width" [disabled]="profileForm.invalid">Create Profile</button>
    </form>
  </div>
</ng-template>

